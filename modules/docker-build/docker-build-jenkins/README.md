# Jenkins

## Running from official image
Jenkins is one of the most popular CICD engines. It has an official container image that we will use to build our own version.

Just launch it from an **lts** version

```
docker run -p 8080:8080 --name jenkins -d jenkins/jenkins:lts
```

You will need a password that is autogenerated during startup so look it up in its logs

```
docker logs jenkins
```

Look for something similar in output

```
*************************************************************
*************************************************************
*************************************************************

Jenkins initial setup is required. An admin user has been created and a password generated.
Please use the following password to proceed to installation:

f009ed4b5e074a69a40f473387af7a02

This may also be found at: /var/jenkins_home/secrets/initialAdminPassword

*************************************************************
*************************************************************
*************************************************************
```

Now open [http://localhost:8080](http://localhost:8080) and finish configuration. Choose *Install suggested plugins* option when asked.

Using Jenkins web interface install kubernetes related plugins

* Go to **Manage Jenkins -> Manage Plugins**
* Select **Available** and use **Filter** to show only plugins with *Kubernetes* in their names
* Select **Kubernetes :: Pipeline :: Aggregator**, **Kubernetes** and **RocketChat Notifier** plugins
* Click **Download now and install after restart**
* On the install page click **Restart Jenkins when installation is complete and no jobs are running** at the bottom to make sure Jenkins will restart after installation

To save your installation just stop the container

```
docker stop jenkins
```

## Build your own jenkins

Now let's build our own version of jenkins with plugins already installed.

Start by creating a dedicated directory for your image e.g.

```
mkdir myjenkins
```

Now in this directory create a **plugins.txt** file with list of plugins you want to be included in your image. Paste there the following list

```
blueocean
kubernetes:1.12.4
kubernetes-pipeline-aggregator:1.5
rocketchatnotifier
```

You need also a container definition - create **Dockerfile** with the following content

```
FROM jenkins/jenkins:lts

COPY plugins.txt /usr/share/jenkins/plugins.txt
RUN /usr/local/bin/install-plugins.sh < /usr/share/jenkins/plugins.txt

# disable startup wizard
ENV JAVA_OPTS="-Djenkins.install.runSetupWizard=false"
```

Now build your first version of jenkins container

```
docker build -t myjenkins:1.0 .
```

and run it

```
docker run -p8080:8080 --name=myjenkins -d myjenkins:1.0
```

After it starts, open browser at [http://localhost:8080](http://localhost:8080) and verify if plugins are installed
* Go to **Manage Jenkins -> Manage Plugins**
* Select **Installed** and use **Filter** to show only plugins with *Kubernetes* in their names
